#!/bin/bash

set -o pipefail
set -e

if systemctl --user --quiet is-active picom
then
  picom_active=0
fi

if [[ ${picom_active} == 0 ]]
then
  systemctl --user stop picom
fi

/usr/bin/pactl set-sink-mute @DEFAULT_SINK@ 1

env -i DISPLAY=${DISPLAY} XAUTHORITY=${XAUTHORITY} slock &
slock_pid=$!

if [[ -e /dev/fd/${XSS_SLEEP_LOCK_FD:--1} ]]; then
  exec {XSS_SLEEP_LOCK_FD}<&-
fi

wait ${slock_pid}

if [[ ${picom_active} == 0 ]]
then
  systemctl --user start picom
fi
