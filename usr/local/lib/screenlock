#!/bin/bash

set -o pipefail
set -e

if systemctl --user --quiet is-active picom
then
  picom_active="true"
fi

if [[ ${picom_active} == "true" ]]
then
  systemctl --user stop picom
fi

/usr/bin/pactl set-sink-mute @DEFAULT_SINK@ 1

env -i DISPLAY=${DISPLAY} XAUTHORITY=${XAUTHORITY} i3lock --image=/home/chris/.sync/wallpapers/lockscreen.png --nofork &
lock_pid=$!

if [[ -e /dev/fd/${XSS_SLEEP_LOCK_FD:--1} ]]; then
  exec {XSS_SLEEP_LOCK_FD}<&-
fi

wait ${lock_pid}

if [[ ${picom_active} == "true" ]]
then
  systemctl --user start picom
fi
